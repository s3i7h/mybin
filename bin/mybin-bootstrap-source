#!/usr/bin/env bash

# save the original PWD
__PWD__=$PWD
# save the path of directory which this script is included
__DIR__="$(
  src="${BASH_SOURCE[0]}"
  while [ -h "$src" ]; do
    dir="$(cd -P "$(dirname "$src")" && pwd)"
    src="$(readlink "$src")"
    [[ $src != /* ]] && src="$dir/$src"
  done
  printf %s "$(cd -P "$(dirname "$src")" && pwd)"
)"
# move to __DIR__ (/bin)
cd -P $__DIR__

# move to repo root (/)
cd ../

files=$(find src/source -type f | grep -E '^src/source/'"$(bin/mybin-platform -s | sed -E 's/([^:]+)/\(\1|_any\)/g' | tr ':' '/')" | sort)

for file in $files; do
    echo "# load $(pwd)/$file"
    cat $file
    echo
done
