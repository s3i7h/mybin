#!/usr/bin/env bash

file=$(mktemp)

while [[ "$1" == "-h" || "$1" == "--header" ]]; do
    shift
    header=$1
    shift
    echo "$header" >> $file
done

script=$(echo "$@")
script=${script:-line}


cat << EOF >> $file
import sys, os, shutil, re

for i, line in enumerate(sys.stdin):
    line, eol, *__unused = *re.split("(\r?\n)", line), ''
    print($script, end=eol)
EOF
python $file
rm $file
