#!/usr/bin/env bash
# instead of cloning into a sub-directory, make the current directory a git repository and pull the remote commits

branch=main
remote=origin
while [ -n "$1" ]; do
    case $1 in
	-b|--branch)
	    shift
	    branch=$1
	    shift
	    ;;
	-r|--remote)
	    shift
	    remote=$1
	    shift
	    ;;
	*)
	    args+=("$1")
	    shift
	    ;;
    esac
done

created=false

function abort() {
    $created && rm -rf .git
    exit $1
}

git -c init.defaultBranch=_ init || abort $?
created=true
git remote add $remote "${args[@]}" || abort $?
git fetch --all || abort $?
git checkout $branch -f || abort $?
